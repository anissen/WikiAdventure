<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>WikiAdventure: Log/LogHandler.h Source File</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
</head>

<body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">Log</a></div>
<h1>LogHandler.h</h1><a href="_log_handler_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 <span class="preprocessor">#ifndef LOGHANDLER_H</span>
00003 <span class="preprocessor"></span><span class="preprocessor">#define LOGHANDLER_H</span>
00004 <span class="preprocessor"></span>
00005 <span class="preprocessor">#include &lt;fstream&gt;</span>
00006 <span class="keyword">using</span> std::ofstream;
00007 
00008 <span class="preprocessor">#include &lt;string&gt;</span>
00009 <span class="keyword">using</span> std::string;
00010 
00011 <span class="preprocessor">#include &lt;vector&gt;</span>
00012 <span class="keyword">using</span> std::vector;
00013 
00014 <span class="preprocessor">#include "time.h"</span> <span class="comment">// For getting the system time</span>
00015 
<a name="l00019"></a><a class="code" href="class_c_file_output.html">00019</a> <span class="keyword">class </span><a class="code" href="class_c_file_output.html">CFileOutput</a>
00020 {
00021 <span class="keyword">private</span>:
00022     string  m_sFileName;
00023     
00024 <span class="keyword">public</span>:
<a name="l00025"></a><a class="code" href="class_c_file_output.html#a0">00025</a>     <a class="code" href="class_c_file_output.html#a0">CFileOutput</a>(<span class="keyword">const</span> string sFileName): m_sFileName(sFileName) {}
<a name="l00026"></a><a class="code" href="class_c_file_output.html#a3">00026</a>     <span class="keyword">virtual</span> <a class="code" href="class_c_file_output.html#a3">~CFileOutput</a>() {}
00027     
<a name="l00028"></a><a class="code" href="class_c_file_output.html#a1">00028</a>     <span class="keywordtype">void</span> <a class="code" href="class_c_file_output.html#a1">ClearFile</a>()
00029     {
00030         ofstream outFile(m_sFileName.c_str(), std::ios::out | std::ios::trunc);
00031         outFile.close();
00032     }
00033     
<a name="l00034"></a><a class="code" href="class_c_file_output.html#a2">00034</a>     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">bool</span> <a class="code" href="class_c_file_output.html#a2">Write</a>(<span class="keyword">const</span> T&amp; Data)
00035     {
00036         <span class="keywordflow">try</span> {
00037             ofstream outFile(m_sFileName.c_str(), std::ios::app); <span class="comment">// Set the append flag</span>
00038             <span class="keywordflow">if</span> (!outFile.is_open()) {
00039                 <span class="keywordflow">throw</span> std::ios::failure(<span class="stringliteral">"Couldn't open file"</span>);
00040             }
00041             
00042             outFile &lt;&lt; Data;
00043             outFile.close();
00044             
00045             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00046         }
00047         <span class="keywordflow">catch</span> (...) {
00048             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00049         }
00050     }
00051 };
00052 
<a name="l00056"></a><a class="code" href="class_c_log_handler.html">00056</a> <span class="keyword">class </span><a class="code" href="class_c_log_handler.html">CLogHandler</a>
00057 {
00058 <span class="keyword">private</span>:
00059     vector&lt;string&gt;  m_vsTags;
00060     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    m_iIndent;
00061 
00062 <span class="keyword">protected</span>:
<a name="l00063"></a><a class="code" href="class_c_log_handler.html#p0">00063</a>     <a class="code" href="class_c_file_output.html">CFileOutput</a>*    <a class="code" href="class_c_log_handler.html#p0">m_CFile</a>;
00064 
00065 <span class="keyword">public</span>:
<a name="l00066"></a><a class="code" href="class_c_log_handler.html#a2">00066</a>     <a class="code" href="class_c_log_handler.html#a2">CLogHandler</a>(<span class="keyword">const</span> string&amp; sFileName)
00067     {
00068         m_iIndent = 0;
00069         <a class="code" href="class_c_log_handler.html#p0">m_CFile</a> = <span class="keyword">new</span> <a class="code" href="class_c_file_output.html">CFileOutput</a>(sFileName);
00070         <a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a1">ClearFile</a>();
00071         <a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(<span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"iso-8859-1\" ?&gt;\n"</span>);
00072     }
00073     
<a name="l00074"></a><a class="code" href="class_c_log_handler.html#a4">00074</a>     <span class="keyword">virtual</span> <a class="code" href="class_c_log_handler.html#a4">~CLogHandler</a>()
00075     {
00076         <span class="keywordflow">while</span>(m_vsTags.size() &gt; 0) {
00077             <a class="code" href="class_c_log_handler.html#a3">CloseTagTree</a>();
00078         }
00079         
00080         <span class="keywordflow">if</span> (<a class="code" href="class_c_log_handler.html#p0">m_CFile</a>) 
00081             <span class="keyword">delete</span> <a class="code" href="class_c_log_handler.html#p0">m_CFile</a>;
00082         <a class="code" href="class_c_log_handler.html#p0">m_CFile</a> = 0;
00083     }
00084 
<a name="l00085"></a><a class="code" href="class_c_log_handler.html#a1">00085</a>     <span class="keywordtype">void</span> <a class="code" href="class_c_log_handler.html#a1">AddTagTree</a> (<span class="keyword">const</span> string&amp; TagName)
00086     {
00087         <a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(string(m_iIndent, <span class="charliteral">'\t'</span>) + string(<span class="stringliteral">"&lt;"</span>) + TagName + string(<span class="stringliteral">"&gt;\n"</span>));
00088         m_vsTags.push_back(TagName);
00089         m_iIndent += 1;
00090     }
00091 
00092     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; 
<a name="l00093"></a><a class="code" href="class_c_log_handler.html#a0">00093</a>     <span class="keywordtype">void</span> <a class="code" href="class_c_log_handler.html#a0">AddTag</a>(<span class="keyword">const</span> string&amp; TagName, <span class="keyword">const</span> T&amp; TagValue)
00094     {
00095         <a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(string(m_iIndent, <span class="charliteral">'\t'</span>) + string(<span class="stringliteral">"&lt;"</span>) + TagName + string(<span class="stringliteral">"&gt;"</span>) );
00096         <a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(TagValue);
00097         <a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(string(<span class="stringliteral">"&lt;/"</span>) + TagName + string(<span class="stringliteral">"&gt;\n"</span>));
00098     }
00099     
<a name="l00100"></a><a class="code" href="class_c_log_handler.html#a3">00100</a>     <span class="keywordtype">void</span> <a class="code" href="class_c_log_handler.html#a3">CloseTagTree</a>()
00101     {
00102         <span class="keywordflow">if</span> (m_vsTags.size() &gt; 0) {
00103             <span class="keywordflow">if</span> (m_iIndent &gt; 0) {
00104                 m_iIndent -= 1;
00105             }
00106             <a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(string(m_iIndent, <span class="charliteral">'\t'</span>) + string(<span class="stringliteral">"&lt;/"</span>) + m_vsTags[m_vsTags.size()-1] + string(<span class="stringliteral">"&gt;\n"</span>));
00107             m_vsTags.pop_back();
00108         }
00109     }
00110 };
00111 
<a name="l00115"></a><a class="code" href="class_c_my_log_handler.html">00115</a> <span class="keyword">class </span><a class="code" href="class_c_my_log_handler.html">CMyLogHandler</a>: <span class="keyword">public</span> <a class="code" href="class_c_log_handler.html">CLogHandler</a>
00116 {
00117 <span class="keyword">public</span>:
<a name="l00118"></a><a class="code" href="class_c_my_log_handler.html#a0">00118</a>     <a class="code" href="class_c_my_log_handler.html#a0">CMyLogHandler</a>(<span class="keyword">const</span> string&amp; sFileName): <a class="code" href="class_c_log_handler.html">CLogHandler</a>(sFileName)
00119     {
00120         this-&gt;<a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(<span class="stringliteral">"&lt;?xml-stylesheet type=\"text/xsl\" href=\"stylesheet.xsl\" ?&gt;\n\n"</span>);
00121 
00122         this-&gt;<a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(<span class="stringliteral">"&lt;!-- WikiDialog Reader Dialog Blocks XML --&gt;\n"</span>);
00123         this-&gt;<a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(<span class="stringliteral">"&lt;!-- Created by XMLLogger --&gt;\n\n"</span>);
00124     }
00125 
<a name="l00126"></a><a class="code" href="class_c_my_log_handler.html#a1">00126</a>     <span class="keyword">virtual</span> <a class="code" href="class_c_my_log_handler.html#a1">~CMyLogHandler</a>()
00127     {
00128         <a class="code" href="class_c_log_handler.html#a4">CLogHandler::~CLogHandler</a>();
00129         this-&gt;<a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(<span class="stringliteral">"\n&lt;!-- Created by XMLLogger --&gt;"</span>);
00130     }
00131 };
00132 
<a name="l00133"></a><a class="code" href="class_c_debug_log_handler.html">00133</a> <span class="keyword">class </span><a class="code" href="class_c_debug_log_handler.html">CDebugLogHandler</a>: <span class="keyword">public</span> <a class="code" href="class_c_log_handler.html">CLogHandler</a>
00134 {
00135 <span class="keyword">public</span>:
<a name="l00136"></a><a class="code" href="class_c_debug_log_handler.html#a0">00136</a>     <a class="code" href="class_c_debug_log_handler.html#a0">CDebugLogHandler</a>(<span class="keyword">const</span> string&amp; sFileName): <a class="code" href="class_c_log_handler.html">CLogHandler</a>(sFileName)
00137     {
00138         this-&gt;<a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(<span class="stringliteral">"&lt;?xml-stylesheet type=\"text/xsl\" href=\"debug-stylesheet.xsl\" ?&gt;\n\n"</span>);
00139         this-&gt;<a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(<span class="stringliteral">"&lt;!-- Created by XMLLogger --&gt;\n\n"</span>);
00140     }
00141 
<a name="l00142"></a><a class="code" href="class_c_debug_log_handler.html#a2">00142</a>     <span class="keyword">virtual</span> <a class="code" href="class_c_debug_log_handler.html#a2">~CDebugLogHandler</a>()
00143     {
00144         <a class="code" href="class_c_log_handler.html#a4">CLogHandler::~CLogHandler</a>();
00145         this-&gt;<a class="code" href="class_c_log_handler.html#p0">m_CFile</a>-&gt;<a class="code" href="class_c_file_output.html#a2">Write</a>(<span class="stringliteral">"\n&lt;!-- Created by XMLLogger --&gt;"</span>);
00146     }
00147 
00148     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00149"></a><a class="code" href="class_c_debug_log_handler.html#a1">00149</a>         <span class="keywordtype">void</span> <a class="code" href="class_c_debug_log_handler.html#a1">WriteLog</a>(<span class="keyword">const</span> string&amp; sClassName,
00150         <span class="keyword">const</span> string&amp; sFuncName, 
00151         <span class="keyword">const</span> string&amp; sDebugType, 
00152         <span class="keyword">const</span> T&amp;      tInfo, 
00153         <span class="keyword">const</span> string&amp; sFile, 
00154         <span class="keyword">const</span> <span class="keywordtype">long</span>&amp;   lLine)
00155     {
00156         time_t systemTime;
00157         systemTime = time(NULL);
00158         string sTime = ctime(&amp;systemTime);
00159         sTime.erase( sTime.length() - 1, 1 ); <span class="comment">// Remove the newline character</span>
00160 
00161         this-&gt;<a class="code" href="class_c_log_handler.html#a1">AddTagTree</a>(<span class="stringliteral">"LogEntry"</span>);
00162         this-&gt;<a class="code" href="class_c_log_handler.html#a0">AddTag</a>(<span class="stringliteral">"ClassName"</span>,   sClassName);
00163         this-&gt;<a class="code" href="class_c_log_handler.html#a0">AddTag</a>(<span class="stringliteral">"FuncName"</span>,    sFuncName);
00164         this-&gt;<a class="code" href="class_c_log_handler.html#a0">AddTag</a>(<span class="stringliteral">"DebugType"</span>,   sDebugType);
00165         this-&gt;<a class="code" href="class_c_log_handler.html#a0">AddTag</a>(<span class="stringliteral">"Timestamp"</span>,   sTime);
00166         this-&gt;<a class="code" href="class_c_log_handler.html#a0">AddTag</a>(<span class="stringliteral">"Info"</span>,        tInfo);
00167         this-&gt;<a class="code" href="class_c_log_handler.html#a0">AddTag</a>(<span class="stringliteral">"File"</span>,        sFile);
00168         this-&gt;<a class="code" href="class_c_log_handler.html#a0">AddTag</a>(<span class="stringliteral">"Line"</span>,        lLine);
00169         this-&gt;<a class="code" href="class_c_log_handler.html#a3">CloseTagTree</a>();   <span class="comment">// LogEntry</span>
00170     }
00171 };
00172 
00173 <span class="preprocessor">#endif LOGHANDLER_H</span>
</pre></div><hr size="1"><address style="align: right;"><small>
Generated on Sat Aug 20 18:11:29 2005 for WikiAdventure by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2</small></address>
</body>
</html>
